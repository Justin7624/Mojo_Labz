<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mojo Labz</title>
<style>
  :root{
    --bg:#070707; --card:#111111; --ink:#f2f2f2; --ink-2:#c9c0a8;
    --brand:#d4af37; --brand-2:#b8860b; --shadow:0 10px 30px rgba(0,0,0,.35);
    --classic-a:#b8860b; --classic-b:#d4af37; --classic-c:#f5d76e;
    --warn:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45}
  img{max-width:100%;display:block}

  header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,var(--bg) 60%,rgba(0,0,0,.7));border-bottom:1px solid #222531}
  .wrap{max-width:1100px;margin:auto;padding:18px}
  .brand-banner{display:flex;justify-content:center}
  .banner-img{width:min(660px,90vw);filter:drop-shadow(var(--shadow))}
  .tabs{display:flex;gap:8px;margin-top:10px}
  .tab{padding:8px 12px;border-radius:999px;border:1px solid #2b2e3b;background:#1b1d24;color:#c7c9d6;cursor:pointer}
  .tab.active{background:rgba(212,175,55,.12);border-color:var(--brand-2);color:#e8e9ef}
  .section{display:none}
  .section.active{display:block}

  .title-row{display:flex;align-items:center;gap:10px;margin-top:12px}
  .title-row h1{margin:0;font-size:22px;font-weight:800}
  .vial-icon{width:28px;height:auto;filter:drop-shadow(0 6px 18px rgba(0,0,0,.35))}

  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px}
  .search{flex:1 1 340px;display:flex;gap:10px;align-items:center;background:#16171c;border:1px solid #272a36;border-radius:999px;padding:10px 14px;box-shadow:var(--shadow)}
  .search input{flex:1;border:0;background:transparent;color:var(--ink);outline:none}
  .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #2b2e3b;background:#1e2027;color:#b8b9c2;padding:8px 12px;border-radius:999px;cursor:pointer}
  .chip.active{border-color:var(--brand-2);background:rgba(212,175,55,.12);color:#e8e9ef}

  .grid{display:grid;gap:16px;margin:16px 0 80px;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
  .card{background:linear-gradient(180deg,#16171c,#15161b);border:1px solid #262938;border-radius:14px;padding:16px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:10px}
  .title{display:flex;justify-content:space-between;align-items:center}
  .title h3{margin:0;font-size:16px}
  .pill{font-size:11px;background:rgba(212,175,55,.12);color:var(--brand);border:1px solid var(--brand-2);padding:5px 8px;border-radius:999px}
  .desc{color:#b8b9c2;font-size:13px}
  .onset{color:#e9e9f5;font-size:12px;background:#1c2130;border:1px dashed #2f3650;padding:8px;border-radius:10px}
  .dose-label{font-size:12px;color:#cfd0d8}
  .doses{display:flex;flex-wrap:wrap;gap:8px}
  .dose{padding:6px 10px;border-radius:10px;border:1px solid #2b2e3b;background:#1a1c22;font-size:12px;color:var(--ink);cursor:pointer;display:inline-flex;align-items:center;gap:8px}
  .dose:disabled{cursor:not-allowed;opacity:.55}
  .stock-badge{font-size:11px;padding:2px 7px;border-radius:999px;border:1px solid #2b2e3b;background:#12141a;color:#aab2c5}
  .stock-badge.ok{border-color:var(--brand-2);color:var(--brand);background:rgba(212,175,55,.08)}
  .stock-badge.low{border-color:#7a6a2f;color:#ffe7a6;background:rgba(255,215,106,.08)}
  .stock-badge.out{border-color:#7a2f2f;color:#ffb0b0;background:rgba(255,107,107,.10)}

  .empty{color:#b8b9c2;text-align:center;padding:40px;border:1px dashed #2b2f3d;border-radius:14px;background:#14161a}

  /* Mini calculator dropdown */
  .mini-wrap{margin-top:8px;border:1px solid #2a2d3c;background:#14161b;border-radius:12px;overflow:visible;display:none}
  .mini-head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;font-weight:700;font-size:13px}
  .mini-sub{font-size:12px;color:#b8b9c2;font-weight:600;margin-top:2px}
  .close-mini{cursor:pointer;border:1px solid #2b2e3b;background:#1a1d26;border-radius:999px;color:#cfd0d8;padding:6px 10px;font-size:12px}
  .mini-body{display:grid;gap:12px;padding:10px 12px;border-top:1px solid #24283a}

  .mini-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}

  .mini-field[data-role-wrap="diluent"] input{max-width:112px}
  .mini-field[data-role-wrap="syringe"] select{max-width:112px}
  .mini-field input[type="number"]{min-width:0}
  .mini-field select{min-width:0}


  /* Mini calculator layout fixes (prevent dropdown clipping/overlap) */
  .mini-wrap{position:relative}
  .mini-body{position:relative}
  .mini-field select{position:relative; z-index:5}
  .dose-row select{position:relative; z-index:6}
  @media (max-width: 560px){
    .mini-grid{grid-template-columns:1fr}
    .dose-row{grid-template-columns:1fr 96px}
    .dose-row .desired-input{width:100% !important; max-width:100% !important;}
    .dose-row select{width:96px !important; min-width:96px !important; max-width:96px !important;}
  
    /* Mobile: prevent "staggered" right-column alignment in single-column layout */
    .mini-field[data-role-wrap="diluent"],
    .mini-field[data-role-wrap="syringe"]{
      justify-self:stretch !important;
      align-self:stretch !important;
    }
    .mini-field[data-role-wrap="diluent"] input,
    .mini-field[data-role-wrap="syringe"] select{
      width:100% !important;
      max-width:100% !important;
    }

  }

  .mini-field{display:flex;flex-direction:column;gap:6px}
  .mini-field label{font-size:12px;color:#b8b9c2}
  .mini-field input, .mini-field select{background:#0f1116;border:1px solid #2b2e3b;border-radius:10px;color:#e8e9ef;padding:8px 10px;font-size:13px}

  /* Mini calculator field width fix (no tile resize) */

  /* Align right-column fields to the right inside the calculator grid */
  .mini-field[data-role-wrap="diluent"],
  .mini-field[data-role-wrap="syringe"]{
    justify-self:end;
    align-self:start;
  }
  .mini-field[data-role-wrap="diluent"] input,
  .mini-field[data-role-wrap="syringe"] select{
    width:112px;
  }


  .mini-field[data-role-wrap="diluent"] input{
    max-width:112px;
  }
  .mini-field[data-role-wrap="syringe"] select{
    max-width:112px;
  }


  .dose-row{display:grid;grid-template-columns:96px 72px;gap:8px;align-items:center;justify-content:start;}
  .dose-row .desired-input{width:96px !important;max-width:96px !important;}
  .dose-row select{width:72px !important;min-width:72px !important;max-width:72px !important;padding:6px 8px;font-size:12px;}

  /* Classic syringe visual (mini) */
  .classic{background:#0c0d11;border:1px solid #272930;border-radius:12px;padding:12px;margin-top:6px}
  .tube{position:relative;height:28px;border-radius:16px;background:linear-gradient(180deg,#11131a,#0b0c10);border:1px solid #2a2c33;box-shadow:inset 0 2px 8px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05)}
  .fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg,var(--classic-a),var(--classic-b));border-radius:16px;box-shadow:inset 0 0 12px rgba(255,255,255,.25), 0 0 16px rgba(212,175,55,.35)}
  .cursor{position:absolute;top:-6px;width:2px;background:var(--classic-c);height:40px;border-radius:2px;box-shadow:0 0 0 2px rgba(37,208,166,.15)}
  .ticks{position:relative;display:flex;justify-content:space-between;align-items:flex-start;margin-top:8px;margin-bottom:6px;padding:0 2px}
  .tick{position:relative;width:1px;background:#3a3d47}
  .tick.minor{height:8px;opacity:.55}
  .tick.major{height:14px}
  .tick .n{position:absolute;top:16px;left:50%;transform:translateX(-50%);font-size:11px;color:#aab2c5}

  .mini-stats{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:18px}
  .stat{background:#10131a;border:1px dashed #2c3450;padding:10px;border-radius:10px;font-size:13px}
  .stat b{display:block;font-size:12px;color:#9fb3d2;margin-bottom:4px}
  .warn{margin-top:10px;color:var(--warn);font-weight:700;font-size:13px}


  /* COA (Certificate of Analysis) */

  /* COA modal / lightbox */
  .bvs-modal-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999;background:rgba(0,0,0,.72);backdrop-filter:blur(6px)}
  .bvs-modal-overlay.open{display:flex}
  .bvs-modal-card{width:min(980px,92vw);max-height:92vh;background:#0f1116;border:1px solid #262938;border-radius:14px;box-shadow:0 18px 60px rgba(0,0,0,.55);overflow:hidden;display:flex;flex-direction:column}
  .bvs-modal-head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #24283a}
  .bvs-modal-head b{font-size:13px}
  .bvs-modal-close{cursor:pointer;border:1px solid #2b2e3b;background:#1a1d26;border-radius:999px;color:#cfd0d8;padding:6px 10px;font-size:12px}
  .bvs-modal-body{padding:12px;overflow:auto}
  .bvs-modal-img{width:100%;height:auto;border-radius:10px;border:1px solid #2b2e3b;background:#0b0d12}
  .bvs-modal-nav{display:flex;gap:8px;align-items:center}
  .bvs-modal-nav button{cursor:pointer;border:1px solid #2b2e3b;background:#1a1d26;border-radius:10px;color:#cfd0d8;padding:6px 10px;font-size:12px}
  .bvs-modal-count{font-size:12px;color:#b8b9c2}

  .coa-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .coa-btn{user-select:none}
  .coa-panel{margin-top:10px;border:1px solid #262938;background:#12141a;border-radius:12px;overflow:hidden;display:none}
  .coa-panel.open{display:block}
  .coa-head{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #24283a}
  .coa-head b{font-size:13px}
  .coa-note{font-size:12px;color:#b8b9c2}
  .coa-body{padding:12px}
  .coa-img{width:100%;border-radius:10px;border:1px solid #2b2e3b;background:#0f1116}
  .coa-placeholder{display:flex;flex-direction:column;gap:8px}
  .coa-placeholder .tag{display:inline-flex;align-items:center;gap:8px;border:1px solid #2b2e3b;background:#1e2027;color:#b8b9c2;padding:6px 10px;border-radius:999px;font-size:12px;width:max-content}
  .coa-placeholder .hint{font-size:12px;color:#b8b9c2;opacity:.9}


  /* Price table */
  .price-toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:16px 0;align-items:center}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{padding:12px 14px;font-size:14px}
  thead th{color:#cfd0d8;text-align:left}
  tbody tr{background:#15161b;border:1px solid #262938;box-shadow:var(--shadow)}
  tbody td:first-child, thead th:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
  tbody td:last-child, thead th:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
  .num{text-align:right;font-variant-numeric:tabular-nums}
  .unit-pill{font-size:11px;background:#19212c;border:1px solid #2a3446;color:#9fb3d2;padding:3px 8px;border-radius:999px}

  .footer{position:fixed;left:0;right:0;bottom:0;background:#0f1116;border-top:1px solid #242736}
  .foot-wrap{max-width:1100px;margin:auto;padding:10px 16px;display:flex;justify-content:space-between;align-items:center}
  .small{font-size:12px;color:#b8b9c2}

/* === Mobile-only calculator layout fix (does NOT affect desktop) === */
@media (max-width: 520px) and (hover: none) and (pointer: coarse){
  /* Stack calculator fields to eliminate overlaps */
  .mini-grid{
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  .mini-field{min-width:0 !important}
  .mini-field input,
  .mini-field select{
    width:100% !important;
    max-width:100% !important;
    min-width:0 !important;
    padding:8px 10px !important;
    font-size:13px !important;
  }

  /* Desired dose row keeps input + unit side-by-side */
  .dose-row{
    grid-template-columns: minmax(0,1fr) 72px !important;
    gap: 10px !important;
    width: 100% !important;
    align-items: center !important;
  }
  .dose-row .desired-input{
    width:100% !important;
    max-width:100% !important;
  }
  .dose-row select,
  select[data-role="unit"]{
    width:76px !important;
    min-width:76px !important;
    max-width:76px !important;
    justify-self:end !important;
  }

  /* Keep syringe scale dropdown full width on phone */
  select[data-role="syringe"],
  input[data-role="diluentMl"],
  input[data-role="mgPerVial"]{
    width:100% !important;
    max-width:100% !important;
  }
}
/* === End mobile-only calculator layout fix === */


  .inv-area{margin-top:10px;padding:10px;border:1px solid rgba(212,175,55,.35);background:linear-gradient(180deg, rgba(212,175,55,.08), rgba(0,0,0,0));border-radius:14px}
  .inv-area .inv-title{font-size:12px;letter-spacing:.08em;text-transform:uppercase;color:var(--ink-2);margin-bottom:6px}
  .inv-pills{display:flex;flex-wrap:wrap;gap:6px}
  .inv-pill{display:inline-flex;gap:6px;align-items:center;padding:6px 8px;border-radius:999px;border:1px solid rgba(212,175,55,.35);background:rgba(0,0,0,.35);font-size:12px;color:var(--ink)}
  .inv-pill strong{color:var(--brand)}
  td.inv{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;color:var(--brand)}

</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand-banner">
        <img src="header.png" alt="Mojo Labz" class="banner-img"/>
      </div>
      <div class="tabs">
        <button class="tab active" data-tab="guide">Guide</button>
        <button class="tab" data-tab="prices">Price Sheet</button>
      </div>
    </div>
  </header>

  <!-- GUIDE -->
  <main class="wrap section active" id="guide">
    <div class="title-row">
      <img src="icon.png" class="vial-icon" alt="Vial"/>
      <h1>Peptide Guide</h1>
    </div>

    <div class="toolbar">
      <div class="search"><input id="q" placeholder="Search name or purpose… (e.g., weight loss, tanning, energy, healing)"/></div>
      <div class="chip active" data-filter="all">All</div>
      <div class="chip" data-filter="weight">Weight & glucose</div>
      <div class="chip" data-filter="tanning">Tanning</div>
      <div class="chip" data-filter="healing">Injury & recovery</div>
      <div class="chip" data-filter="energy">Energy / anti-aging</div>
      <div class="chip" data-filter="supplies">Mixing supplies</div>
      <button class="chip" id="expand">Expand all</button>
      <button class="chip" id="collapse">Collapse all</button>
      <button class="chip" id="toggleOOS" aria-pressed="false">Hide out-of-stock</button>
    </div>

    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">No items match your search/filter.</div>
  </main>

  <!-- PRICE SHEET -->
  <main class="wrap section" id="prices">
    <div class="title-row" style="margin-top:6px">
      <img src="Black_Vial_Society_Transparent_Logo.png" class="vial-icon" alt="Vial"/>
      <h1>Price Sheet</h1>
    </div>

    <div class="price-toolbar">
      <div class="search"><input id="pq" placeholder="Search product or strength…"/></div>
      <button class="chip" id="ptoggleOOS" aria-pressed="false">Hide out-of-stock</button>
      <span class="small">Click headers to sort</span>
    </div>

    <div class="small" style="margin-bottom:8px">Price per unit = price ÷ amount (mg or IU). (Vials only.)</div>
    <table id="priceTable">
      <thead>
        <tr>
          <th class="sort" data-sort="invId">ID</th>
          <th class="sort" data-sort="name">Product</th>
          <th class="sort" data-sort="strength">Strength</th>
          <th class="sort num" data-sort="amount">Amount</th>
          <th class="sort num" data-sort="price">Price</th>
          <th class="sort num" data-sort="ppu">Price / unit</th>
          <th class="sort num" data-sort="stock">Stock</th>
          <th>Unit</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="pempty" class="empty" style="display:none">No matches.</div>
  </main>

  <footer class="footer">
    <div class="foot-wrap">
      <div class="small">Educational use only. Not medical advice.</div>
      <div></div>
    </div>
  </footer>

<script>
/* ---------- Utilities ---------- */
const esc = s => String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
const money = n => `$${Number(n).toFixed(2)}`;
const num = n => Number(n).toFixed(2);

/* ---------- Classic math with unit handling ---------- */
function classicCalc({amountPerVial, vialUnit='mg', diluentMl, desired, desiredUnit='mg', syringeScale=100}) {
  const amt   = Number(amountPerVial)||0;
  const mlD   = Number(diluentMl)||0;
  const want  = Number(desired)||0;
  const scale = Number(syringeScale)||100;

  const vUnit = String(vialUnit||'mg').toLowerCase();
  const dUnit = String(desiredUnit||'mg').toLowerCase();

  let desiredInVial = NaN;
  let note = '';

  if (vUnit === 'mg') {
    if (dUnit === 'mg') desiredInVial = want;
    else if (dUnit === 'mcg') desiredInVial = want/1000;
    else if (dUnit === 'iu') note = 'Unit mismatch: this vial is in mg, but desired dose is in IU. mg ↔ IU conversion is not possible without a product-specific factor.';
    else note = 'Unsupported desired dose unit.';
  } else if (vUnit === 'iu') {
    if (dUnit === 'iu') desiredInVial = want;
    else if (dUnit === 'mg' || dUnit === 'mcg') note = 'Unit mismatch: this vial is in IU, but desired dose is in mg/mcg. mg ↔ IU conversion is not possible without a product-specific factor.';
    else note = 'Unsupported desired dose unit.';
  } else {
    note = 'Unsupported vial unit.';
  }

  // concentration in "vial units" (mg or IU) per mL
  const perMl = (amt>0 && mlD>0) ? (amt/mlD) : NaN;

  // insulin syringe assumption: 1 unit = 0.01 mL
  const vialUnitsPerUnit = isFinite(perMl) ? (perMl * 0.01) : NaN;

  // syringe units to pull
  const syringeUnits = (isFinite(vialUnitsPerUnit) && isFinite(desiredInVial) && desiredInVial>=0)
    ? (desiredInVial / vialUnitsPerUnit)
    : NaN;

  const pct = (isFinite(syringeUnits) && scale>0)
    ? Math.max(0, Math.min(100, (syringeUnits/scale)*100))
    : 0;

  return { vialUnit:vUnit, desiredUnit:dUnit, vialUnitsPerUnit, units:syringeUnits, unitsPct:pct, syringeScale:scale, note };
}

/* ---------- FULL GUIDE DATA (AUTO-GENERATED FROM INVENTORY) ---------- */
const GUIDE = [
  {
    "key": "glp3rt",
    "name": "GLP-3RT (Retatrutide)",
    "badge": "Weight",
    "category": "weight",
    "short": "Strong appetite support; many use it to help cut cravings and stay full longer.",
    "onset": "Some notice appetite changes within 1–2 weeks; results build over time.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "15 mg",
      "20 mg",
      "30 mg",
      "40 mg",
      "50 mg",
      "60 mg",
      "10mg kit x10",
      "20mg kit x10"
    ],
    "stock": {
      "5 mg": 35,
      "10 mg": 118,
      "15 mg": 9,
      "20 mg": 110,
      "30 mg": 10,
      "40 mg": 10,
      "50 mg": 10,
      "60 mg": 10,
      "10mg kit x10": 8,
      "20mg kit x10": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "glp2tz",
    "name": "GLP-2TZ (Tirzepatide)",
    "badge": "Weight",
    "category": "weight",
    "short": "Helps reduce appetite and can support steadier blood sugar.",
    "onset": "Typically gradual—many describe changes week by week.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "15 mg",
      "20 mg",
      "30 mg",
      "40 mg",
      "50 mg",
      "60 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 19,
      "15 mg": 20,
      "20 mg": 9,
      "30 mg": 20,
      "40 mg": 10,
      "50 mg": 10,
      "60 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "glp1sg",
    "name": "GLP-1SG (Semaglutide)",
    "badge": "Weight",
    "category": "weight",
    "short": "Popular for appetite control—can make smaller meals feel satisfying.",
    "onset": "Many notice appetite changes within a few weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "15 mg",
      "20 mg"
    ],
    "stock": {
      "5 mg": 26,
      "10 mg": 28,
      "15 mg": 10,
      "20 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "survodutide",
    "name": "Survodutide",
    "badge": "Weight",
    "category": "weight",
    "short": "Dual-agonist research peptide explored for metabolic and weight-related pathways.",
    "onset": "Gradual, often over weeks",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "cagrilintide",
    "name": "Cagrilintide",
    "badge": "Weight",
    "category": "weight",
    "short": "Amylin-pathway support—often described as “quieting food noise.”",
    "onset": "Gradual over weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 14,
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "motsc",
    "name": "MOTS-C",
    "badge": "Metabolic",
    "category": "energy",
    "short": "Metabolism/energy support—some describe better stamina and “cleaner” energy.",
    "onset": "Subtle at first; often discussed as building over weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg",
      "30 mg",
      "40 mg"
    ],
    "stock": {
      "10 mg": 17,
      "30 mg": 9,
      "40 mg": 8
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "bpc157",
    "name": "BPC-157",
    "badge": "Recovery",
    "category": "healing",
    "short": "Often used for injury recovery—tendons, joints, and “nagging” aches.",
    "onset": "Some feel relief in days; deeper recovery takes longer.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg",
      "20 mg"
    ],
    "stock": {
      "10 mg": 7,
      "20 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "wolverinebpc5mgtb5mg",
    "name": "Wolverine BPC 5mg+TB 5mg",
    "badge": "Recovery",
    "category": "healing",
    "short": "Combo recovery vial—often used for joints, mobility, and soft tissue repair support.",
    "onset": "Often described as gradual over weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "wolverinebpc10mgtb10",
    "name": "Wolverine BPC 10mg+TB 10mg",
    "badge": "Recovery",
    "category": "healing",
    "short": "Higher strength combo—aimed at longer recovery runs and stubborn issues.",
    "onset": "Often described as gradual over weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "20 mg"
    ],
    "stock": {
      "20 mg": 8
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "tb500",
    "name": "TB500 (Thymosin B4 Acetate)",
    "badge": "Recovery",
    "category": "healing",
    "short": "Commonly used to support mobility, recovery, and soft tissue repair.",
    "onset": "Usually described as building over weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "Thymosin B4 Acetate": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "melanotan",
    "name": "Melanotan",
    "badge": "Tanning",
    "category": "tanning",
    "short": "Supports tanning response—can help deepen tone with less sun exposure.",
    "onset": "Often noticeable over days to weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "melanotan2",
    "name": "Melanotan 2",
    "badge": "Tanning",
    "category": "tanning",
    "short": "Similar tanning support—many describe faster/deeper results than MT-1.",
    "onset": "Often noticeable over days to weeks.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "glow",
    "name": "GLOW",
    "badge": "Wellness",
    "category": "energy",
    "short": "Beauty-style blend—marketed for skin glow, tone, and overall wellness vibes.",
    "onset": "Usually gradual (weeks+).",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "70 mg"
    ],
    "stock": {
      "70 mg": 7
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "klow",
    "name": "KLOW",
    "badge": "Wellness",
    "category": "energy",
    "short": "Wellness blend—often described as “feel-good” support and body balance.",
    "onset": "Usually gradual (weeks+).",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "80 mg"
    ],
    "stock": {
      "80 mg": 27
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "nad",
    "name": "NAD+",
    "badge": "Wellness",
    "category": "energy",
    "short": "Energy + clarity support—people use it for a “reset” feeling and better drive.",
    "onset": "Some feel it same-day; others notice gradually.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "500 mg",
      "1000 mg"
    ],
    "stock": {
      "500 mg": 13,
      "1000 mg": 17
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "ipamorelin",
    "name": "Ipamorelin",
    "badge": "Wellness",
    "category": "energy",
    "short": "GH-support peptide—used for recovery, sleep quality, and body composition goals.",
    "onset": "Often subtle; tends to be gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 4
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "tesamorelin",
    "name": "Tesamorelin",
    "badge": "Wellness",
    "category": "energy",
    "short": "Often used for body composition—especially “stubborn” midsection goals.",
    "onset": "Gradual over weeks to months.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 6,
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "sermorelinacetate",
    "name": "Sermorelin Acetate",
    "badge": "Wellness",
    "category": "energy",
    "short": "GH-pathway support—often used to improve recovery and overall “rested” feeling.",
    "onset": "Gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 0,
      "10 mg": 0
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "ss31",
    "name": "SS-31",
    "badge": "Longevity",
    "category": "energy",
    "short": "Mito support—marketed for steadier energy and better “cell power.”",
    "onset": "Often subtle; builds with time.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg",
      "50 mg"
    ],
    "stock": {
      "10 mg": 18,
      "50 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "igf1lr3",
    "name": "IGF-1 LR3",
    "badge": "Performance",
    "category": "energy",
    "short": "Performance/growth support—often discussed for muscle and recovery goals.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "1 mg"
    ],
    "stock": {
      "1 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "ghkcu",
    "name": "GHK-CU",
    "badge": "Skin",
    "category": "energy",
    "short": "Copper peptide—supports skin texture and collagen-focused routines.",
    "onset": "Usually gradual (weeks+).",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "50 mg",
      "100 mg"
    ],
    "stock": {
      "50 mg": 9,
      "100 mg": 16
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "dsip",
    "name": "DSIP",
    "badge": "Nootropic",
    "category": "energy",
    "short": "Sleep support—used for deeper rest and calmer nights.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "15 mg"
    ],
    "stock": {
      "5 mg": 7,
      "10 mg": 10,
      "15 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "epithalon",
    "name": "Epithalon",
    "badge": "Longevity",
    "category": "energy",
    "short": "Longevity-style peptide—often used for “aging support” and overall vitality.",
    "onset": "Usually gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg",
      "50 mg"
    ],
    "stock": {
      "10 mg": 16,
      "50 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "kpv",
    "name": "KPV",
    "badge": "Longevity",
    "category": "energy",
    "short": "Calming peptide often discussed for skin/gut comfort and inflammation-prone routines.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 3
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "semax",
    "name": "Semax",
    "badge": "Nootropic",
    "category": "energy",
    "short": "Focus support—often used for clarity, motivation, and “sharp” workdays.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "30 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 12,
      "30 mg": 0
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "selank",
    "name": "Selank",
    "badge": "Nootropic",
    "category": "energy",
    "short": "Calm focus—often used for stress support without feeling “dull.”",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "30 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 15,
      "30 mg": 30
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "5amino1mq",
    "name": "5-amino-1mq",
    "badge": "Metabolic",
    "category": "energy",
    "short": "Metabolic support—often used for recomposition goals and “leaner” progress.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg",
      "50 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 10,
      "50 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "cjc1295nodac",
    "name": "CJC-1295 no DAC",
    "badge": "Wellness",
    "category": "energy",
    "short": "GH-support peptide—often used for recovery, sleep quality, and body goals.",
    "onset": "Gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 3
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "cjc1295withdac",
    "name": "CJC-1295 with DAC",
    "badge": "Wellness",
    "category": "energy",
    "short": "Longer-acting CJC variant often discussed for steadier GH/IGF signaling.",
    "onset": "Gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg"
    ],
    "stock": {
      "5 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "cjc1295nodac5mgipa5m",
    "name": "CJC-1295 no DAC 5mg + IPA 5mg",
    "badge": "Wellness",
    "category": "energy",
    "short": "Classic GH combo—popular for recovery, sleep, and physique support.",
    "onset": "Gradual.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "aod9604",
    "name": "AOD-9604",
    "badge": "Weight",
    "category": "weight",
    "short": "Fat-loss support peptide—often used for stubborn areas and cutting phases.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "foxo4dri",
    "name": "FOXO4-DRI",
    "badge": "Longevity",
    "category": "energy",
    "short": "Experimental longevity peptide—often discussed in senescent-cell research circles.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "ahkcu",
    "name": "AHK-CU",
    "badge": "Skin",
    "category": "energy",
    "short": "Copper peptide—supports healthier-looking skin and smoother texture.",
    "onset": "Gradual (weeks+).",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "100 mg"
    ],
    "stock": {
      "100 mg": 29
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "glutathione",
    "name": "Glutathione",
    "badge": "Antioxidant",
    "category": "energy",
    "short": "Antioxidant support—often used for overall wellness and “bright” skin routines.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "1500 mg"
    ],
    "stock": {
      "1500 mg": 8
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "hgh191aa",
    "name": "HGH 191AA (Somatropin)",
    "badge": "Hormone",
    "category": "energy",
    "short": "Prescription hormone—used for GH therapy under medical supervision.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10iu",
      "15iu",
      "24iu",
      "36iu"
    ],
    "stock": {
      "10iu": 49,
      "15iu": 30,
      "24iu": 39,
      "36iu": 17
    },
    "more": "<ul><li>Educational info only—always confirm your label, strength (IU), and storage.</li></ul>"
  },
  {
    "key": "kisspeptin10",
    "name": "KissPeptin-10",
    "badge": "Hormone",
    "category": "energy",
    "short": "Hormone signaling peptide—often discussed for reproductive axis support.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 9
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "vip",
    "name": "VIP",
    "badge": "Wellness",
    "category": "energy",
    "short": "Neuropeptide discussed for recovery and “system calming” support.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg",
      "10 mg"
    ],
    "stock": {
      "5 mg": 10,
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "snap8",
    "name": "snap-8",
    "badge": "Skin",
    "category": "energy",
    "short": "Cosmetic peptide commonly used in topical/beauty formulations for smoother-looking skin.",
    "onset": "Gradual (weeks+).",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "hcg",
    "name": "HCG",
    "badge": "Hormone",
    "category": "energy",
    "short": "Hormone-related compound often discussed in fertility or endocrine contexts—best handled with medical guidance.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5,000 iu",
      "10,000 iu"
    ],
    "stock": {
      "5,000 iu": 20,
      "10,000 iu": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "pt141",
    "name": "PT-141",
    "badge": "Wellness",
    "category": "energy",
    "short": "Often discussed for libido/sexual wellness support via melanocortin pathways.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 7
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "ara290",
    "name": "Ara-290",
    "badge": "Wellness",
    "category": "energy",
    "short": "Research peptide discussed for tissue/nerve support and recovery contexts.",
    "onset": "Varies.",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "10 mg"
    ],
    "stock": {
      "10 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "Pinealon",
    "name": "Pinealon",
    "badge": "Longevity",
    "category": "nootropic",
    "short": "Synthetic tripeptide studied for potential neuroprotective and longevity-related properties.",
    "onset": "Varies",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "20 mg"
    ],
    "stock": {
      "20 mg": 10
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "SLU-PP-332",
    "name": "SLU-PP-332",
    "badge": "Metabolic",
    "category": "energy",
    "short": "Studied for its potential role in metabolic regulation and energy balance.",
    "onset": "Varies",
    "fact": "Form: Lyophilized powder",
    "doses": [
      "5 mg"
    ],
    "stock": {
      "5 mg": 25
    },
    "more": "<ul><li>Educational info only—always confirm your label and concentration.</li></ul>"
  },
  {
    "key": "easytouch31gauge1ml5",
    "name": "easytouch 31 gauge 1ml 5/16\" 8mm",
    "badge": "Supply",
    "category": "supplies",
    "short": "Insulin syringes used for reconstitution workflows (supply item).",
    "onset": "—",
    "fact": "Form: Insulin Syringe",
    "doses": [
      "10 pack"
    ],
    "stock": {
      "10 pack": 70
    },
    "more": "<ul><li>Supply item. Keep sterile; label concentration and date once opened/used.</li></ul>"
  },
  {
    "key": "lemonbottle",
    "name": "Lemon Bottle",
    "badge": "Supply",
    "category": "supplies",
    "short": "Cosmetic liquid product used in aesthetic contexts; follow label guidance.",
    "onset": "—",
    "fact": "Form: Liquid",
    "doses": [
      "10 mg/ 10 mL"
    ],
    "stock": {
      "10 mg/ 10 mL": 6
    },
    "more": "<ul><li>Supply item. Keep sterile; label concentration and date once opened/used.</li></ul>"
  },
  {
    "key": "bacwater",
    "name": "Bac Water",
    "badge": "Supply",
    "category": "supplies",
    "short": "Sterile bacteriostatic water for reconstitution (supply item).",
    "onset": "—",
    "fact": "Form: Liquid",
    "doses": [
      "10 mL"
    ],
    "stock": {
      "10 mL": 198
    },
    "more": "<ul><li>Supply item. Keep sterile; label concentration and date once opened/used.</li></ul>"
  },
  {
    "key": "aceticacid",
    "name": "Acetic Acid 6%",
    "badge": "Supply",
    "category": "supplies",
    "short": "Acidic diluent used only when a peptide specifically calls for it.",
    "onset": "—",
    "fact": "Form: Liquid",
    "doses": [
      "10 mL"
    ],
    "stock": {
      "10 mL": 8
    },
    "more": "<ul><li>Supply item. Keep sterile; label concentration and date once opened/used.</li></ul>"
  },
  {
    "key": "hospirabacwater",
    "name": "Hospira Bac Water",
    "badge": "Supply",
    "category": "supplies",
    "short": "Brand bacteriostatic water for reconstitution (supply item).",
    "onset": "—",
    "fact": "Form: Liquid",
    "doses": [
      "30 mL"
    ],
    "stock": {
      "30 mL": 396
    },
    "more": "<ul><li>Supply item. Keep sterile; label concentration and date once opened/used.</li></ul>"
  }
];

/* ---------- PRICES (AUTO-GENERATED FROM INVENTORY) ----------
   Structure: [name, strength, rawPrice, unit, stock]
   Note: All pricing is displayed as RAW PRICE (no multipliers or rounding).
*/
const PRICES_RAW = [
  [
    "GLP-3RT (Retatrutide)",
    "5 mg",
    15.0,
    "mg",
    35
  ],
  [
    "GLP-3RT (Retatrutide)",
    "10 mg",
    20.0,
    "mg",
    118
  ],
  [
    "GLP-3RT (Retatrutide)",
    "15 mg",
    24.0,
    "mg",
    9
  ],
  [
    "GLP-3RT (Retatrutide)",
    "20 mg",
    28.0,
    "mg",
    110
  ],
  [
    "GLP-3RT (Retatrutide)",
    "30 mg",
    35.0,
    "mg",
    10
  ],
  [
    "GLP-3RT (Retatrutide)",
    "40 mg",
    45.0,
    "mg",
    10
  ],
  [
    "GLP-3RT (Retatrutide)",
    "50 mg",
    55.0,
    "mg",
    10
  ],
  [
    "GLP-3RT (Retatrutide)",
    "60 mg",
    65.0,
    "mg",
    10
  ],
  [
    "GLP-3RT (Retatrutide)",
    "10mg kit x10",
    160.0,
    "mg",
    8
  ],
  [
    "GLP-3RT (Retatrutide)",
    "20mg kit x10",
    200.0,
    "mg",
    9
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "5 mg",
    14.0,
    "mg",
    10
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "10 mg",
    16.0,
    "mg",
    19
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "15 mg",
    19.0,
    "mg",
    20
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "20 mg",
    22.0,
    "mg",
    9
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "30 mg",
    30.0,
    "mg",
    20
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "40 mg",
    35.0,
    "mg",
    10
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "50 mg",
    40.0,
    "mg",
    10
  ],
  [
    "GLP-2TZ (Tirzepatide)",
    "60 mg",
    50.0,
    "mg",
    10
  ],
  [
    "GLP-1SG (Semaglutide)",
    "5 mg",
    13.0,
    "mg",
    26
  ],
  [
    "GLP-1SG (Semaglutide)",
    "10 mg",
    16.0,
    "mg",
    28
  ],
  [
    "GLP-1SG (Semaglutide)",
    "15 mg",
    19.0,
    "mg",
    10
  ],
  [
    "GLP-1SG (Semaglutide)",
    "20 mg",
    22.0,
    "mg",
    10
  ],
  [
    "Survodutide",
    "10 mg",
    35.0,
    "mg",
    10
  ],
  [
    "Cagrilintide",
    "5 mg",
    20.0,
    "mg",
    14
  ],
  [
    "Cagrilintide",
    "10 mg",
    30.0,
    "mg",
    10
  ],
  [
    "MOTS-C",
    "10 mg",
    20.0,
    "mg",
    17
  ],
  [
    "MOTS-C",
    "30 mg",
    40.0,
    "mg",
    9
  ],
  [
    "MOTS-C",
    "40 mg",
    50.0,
    "mg",
    8
  ],
  [
    "BPC-157",
    "10 mg",
    16.0,
    "mg",
    7
  ],
  [
    "BPC-157",
    "20 mg",
    30.0,
    "mg",
    10
  ],
  [
    "Wolverine BPC 5mg+TB 5mg",
    "10 mg",
    22.0,
    "mg",
    9
  ],
  [
    "Wolverine BPC 10mg+TB 10mg",
    "20 mg",
    32.0,
    "mg",
    8
  ],
  [
    "TB500 (Thymosin B4 Acetate)",
    "5 mg",
    18.0,
    "mg",
    10
  ],
  [
    "TB500 (Thymosin B4 Acetate)",
    "10 mg",
    24.0,
    "mg",
    10
  ],
  [
    "Melanotan",
    "10 mg",
    16.0,
    "mg",
    9
  ],
  [
    "Melanotan 2",
    "10 mg",
    16.0,
    "mg",
    9
  ],
  [
    "GLOW",
    "70 mg",
    30.0,
    "mg",
    7
  ],
  [
    "KLOW",
    "80 mg",
    35.0,
    "mg",
    27
  ],
  [
    "NAD+",
    "500 mg",
    18.0,
    "mg",
    13
  ],
  [
    "NAD+",
    "1000 mg",
    32.0,
    "mg",
    17
  ],
  [
    "Ipamorelin",
    "5 mg",
    16.0,
    "mg",
    10
  ],
  [
    "Ipamorelin",
    "10 mg",
    20.0,
    "mg",
    4
  ],
  [
    "Tesamorelin",
    "5 mg",
    20.0,
    "mg",
    6
  ],
  [
    "Tesamorelin",
    "10 mg",
    28.0,
    "mg",
    10
  ],
  [
    "Sermorelin Acetate",
    "5 mg",
    18.0,
    "mg",
    0
  ],
  [
    "Sermorelin Acetate",
    "10 mg",
    24.0,
    "mg",
    0
  ],
  [
    "SS-31",
    "10 mg",
    20.0,
    "mg",
    18
  ],
  [
    "SS-31",
    "50 mg",
    45.0,
    "mg",
    10
  ],
  [
    "IGF-1 LR3",
    "1 mg",
    30.0,
    "mg",
    10
  ],
  [
    "GHK-CU",
    "50 mg",
    15.0,
    "mg",
    9
  ],
  [
    "GHK-CU",
    "100 mg",
    20.0,
    "mg",
    16
  ],
  [
    "DSIP",
    "5 mg",
    15.0,
    "mg",
    7
  ],
  [
    "DSIP",
    "10 mg",
    18.0,
    "mg",
    10
  ],
  [
    "DSIP",
    "15 mg",
    21.0,
    "mg",
    10
  ],
  [
    "Epithalon",
    "10 mg",
    15.0,
    "mg",
    16
  ],
  [
    "Epithalon",
    "50 mg",
    36.0,
    "mg",
    10
  ],
  [
    "KPV",
    "5 mg",
    18.0,
    "mg",
    10
  ],
  [
    "KPV",
    "10 mg",
    22.0,
    "mg",
    3
  ],
  [
    "Semax",
    "5 mg",
    13.0,
    "mg",
    10
  ],
  [
    "Semax",
    "10 mg",
    17.0,
    "mg",
    12
  ],
  [
    "Semax",
    "30 mg",
    30.0,
    "mg",
    0
  ],
  [
    "Selank",
    "5 mg",
    13.0,
    "mg",
    10
  ],
  [
    "Selank",
    "10 mg",
    17.0,
    "mg",
    15
  ],
  [
    "Selank",
    "30 mg",
    30.0,
    "mg",
    30
  ],
  [
    "5-amino-1mq",
    "5 mg",
    15.0,
    "mg",
    10
  ],
  [
    "5-amino-1mq",
    "10 mg",
    19.0,
    "mg",
    10
  ],
  [
    "5-amino-1mq",
    "50 mg",
    36.0,
    "mg",
    9
  ],
  [
    "CJC-1295 no DAC",
    "5 mg",
    18.0,
    "mg",
    10
  ],
  [
    "CJC-1295 no DAC",
    "10 mg",
    24.0,
    "mg",
    3
  ],
  [
    "CJC-1295 with DAC",
    "5 mg",
    18.0,
    "mg",
    10
  ],
  [
    "CJC-1295 no DAC 5mg + IPA 5mg",
    "10 mg",
    20.0,
    "mg",
    10
  ],
  [
    "AOD-9604",
    "5 mg",
    20.0,
    "mg",
    10
  ],
  [
    "AOD-9604",
    "10 mg",
    28.0,
    "mg",
    10
  ],
  [
    "FOXO4-DRI",
    "10 mg",
    45.0,
    "mg",
    9
  ],
  [
    "AHK-CU",
    "100 mg",
    18.0,
    "mg",
    29
  ],
  [
    "Glutathione",
    "1500 mg",
    20.0,
    "mg",
    8
  ],
  [
    "HGH 191AA (Somatropin)",
    "10iu",
    18.0,
    "iu",
    49
  ],
  [
    "HGH 191AA (Somatropin)",
    "15iu",
    22.0,
    "iu",
    30
  ],
  [
    "HGH 191AA (Somatropin)",
    "24iu",
    26.0,
    "iu",
    39
  ],
  [
    "HGH 191AA (Somatropin)",
    "36iu",
    30.0,
    "iu",
    17
  ],
  [
    "KissPeptin-10",
    "10 mg",
    20.0,
    "mg",
    9
  ],
  [
    "VIP",
    "5 mg",
    20.0,
    "mg",
    10
  ],
  [
    "VIP",
    "10 mg",
    28.0,
    "mg",
    10
  ],
  [
    "snap-8",
    "10 mg",
    15.0,
    "mg",
    10
  ],
  [
    "HCG",
    "5,000 iu",
    20.0,
    "iu",
    20
  ],
  [
    "HCG",
    "10,000 iu",
    26.0,
    "iu",
    10
  ],
  [
    "PT-141",
    "10 mg",
    20.0,
    "mg",
    7
  ],
  [
    "Ara-290",
    "10 mg",
    18.0,
    "mg",
    10
  ],
  [
    "Pinealon",
    "20 mg",
    22.0,
    "mg",
    10
  ],
  [
    "SLU-PP-332",
    "5 mg",
    25.0,
    "mg",
    25
  ],
  [
    "easytouch 31 gauge 1ml 5/16\" 8mm",
    "10 pack",
    5.0,
    "pack",
    70
  ],
  [
    "Lemon Bottle",
    "10 mg/ 10 mL",
    20.0,
    "mL",
    6
  ],
  [
    "Bac Water",
    "10 mL",
    5.0,
    "mL",
    198
  ],
  [
    "Acetic Acid 6%",
    "10 mL",
    6.0,
    "mL",
    8
  ],
  [
    "Hospira Bac Water",
    "30 mL",
    15.0,
    "mL",
    396
  ]
];

const PRICES = PRICES_RAW.map(([name, strength, price, unit, stock]) => {
  return [name, strength, Number(price), unit, Number(stock) || 0];
});


/* ---------- Inventory IDs (manual mapping) ----------
   Provided in order to match product labels shown on-site.
*/
const INVENTORY_IDS = [
  {"label": "GLP-3RT (5mg)", "id": "RT5"},
  {"label": "GLP-3RT (10mg)", "id": "RT10"},
  {"label": "GLP-3RT (15mg)", "id": "RT15"},
  {"label": "GLP-3RT (20mg)", "id": "RT20"},
  {"label": "GLP-3RT (30mg)", "id": "RT30"},
  {"label": "GLP-3RT (40mg)", "id": "RT40"},
  {"label": "GLP-3RT (50mg)", "id": "RT50"},
  {"label": "GLP-3RT (60mg)", "id": "RT60"},
  {"label": "GLP-2TZ (5mg)", "id": "TR5"},
  {"label": "GLP-2TZ (10mg)", "id": "TR10"},
  {"label": "GLP-2TZ (15mg)", "id": "TR15"},
  {"label": "GLP-2TZ (20mg)", "id": "TR20"},
  {"label": "GLP-2TZ (30mg)", "id": "TR30"},
  {"label": "GLP-2TZ (40mg)", "id": "TR40"},
  {"label": "GLP-2TZ (50mg)", "id": "TR50"},
  {"label": "GLP-2TZ (60mg)", "id": "TR60"},
  {"label": "GLP-1SG (5mg)", "id": "SM5"},
  {"label": "GLP-1SG (10mg)", "id": "SM10"},
  {"label": "GLP-1SG (15mg)", "id": "SM15"},
  {"label": "GLP-1SG (20mg)", "id": "SM20"},
  {"label": "Survodutide (10mg)", "id": "SUR10"},
  {"label": "Cagrilintide (5mg)", "id": "CGL5"},
  {"label": "Cagrilintide (10mg)", "id": "CGL10"},
  {"label": "MOTS-C (10mg)", "id": "MS10"},
  {"label": "MOTS-C (30mg)", "id": "MS30"},
  {"label": "MOTS-C (40mg)", "id": "MS40"},
  {"label": "BPC-157 (10mg)", "id": "BC10"},
  {"label": "BPC-157 (20mg)", "id": "BC20"},
  {"label": "Wolverine BPC 5mg+TB 5mg (10mg)", "id": "BB10"},
  {"label": "Wolverine BPC 10mg+TB 10mg (20mg)", "id": "BB20"},
  {"label": "TB500(Thymosin B4 Acetate)(5mg)", "id": "BT5"},
  {"label": "TB500(Thymosin B4 Acetate)(10mg)", "id": "BT10"},
  {"label": "Melanotan (10mg)", "id": "MT1"},
  {"label": "Melanotan 2 (10mg)", "id": "MT2"},
  {"label": "GLOW (70mg)", "id": "BB70"},
  {"label": "KLOW (80mg)", "id": "KLOW80"},
  {"label": "NAD + (500mg)", "id": "NJ500"},
  {"label": "NAD + (1000mg)", "id": "NJ1000"},
  {"label": "Ipamorelin (5mg)", "id": "IP5"},
  {"label": "Ipamorelin (10mg)", "id": "IP10"},
  {"label": "Tesamorelin (5mg)", "id": "TSM5"},
  {"label": "Tesamorelin (10mg)", "id": "TSM10"},
  {"label": "Sermorelin Acetate (5mg)", "id": "SM05"},
  {"label": "Sermorelin Acetate (10mg)", "id": "SM010"},
  {"label": "SS-31  (10mg)", "id": "2S10"},
  {"label": "SS-31  (50mg)", "id": "2S50"},
  {"label": "IGF-1LR3 (1mg)", "id": "IG1"},
  {"label": "GHK-CU (50mg)", "id": "CU50"},
  {"label": "GHK-CU (100mg)", "id": "CU100"},
  {"label": "DSIP (5mg)", "id": "DS5"},
  {"label": "DSIP (10mg)", "id": "DS10"},
  {"label": "DSIP (15mg)", "id": "DS15"},
  {"label": "Epithalon (10mg)", "id": "ET10"},
  {"label": "Epithalon (50mg)", "id": "ET50"},
  {"label": "KPV (5mg)", "id": "KPV5"},
  {"label": "KPV (10mg)", "id": "KPV10"},
  {"label": "Semax (5mg)", "id": "XA5"},
  {"label": "Semax (10mg)", "id": "XA10"},
  {"label": "Semax (30mg)", "id": "XA30"},
  {"label": "Selank (5mg)", "id": "SK5"},
  {"label": "Selank (10mg)", "id": "SK10"},
  {"label": "Selank (30mg)", "id": "SK30"},
  {"label": "5-amino-1mq (5mg)", "id": "5AM"},
  {"label": "5-amino-1mq (10mg)", "id": "10AM"},
  {"label": "5-amino-1mq (50mg)", "id": "50AM"},
  {"label": "CJC-1295 no DAC (5mg)", "id": "CND5"},
  {"label": "CJC-1295 no DAC (10mg)", "id": "CND10"},
  {"label": "CJC-1295 with DAC (5mg)", "id": "CD5"},
  {"label": "CJC-1295 no DAC 5mg + IPA 5mg (10mg)", "id": "CP10"},
  {"label": "AOD-9604 (5mg)", "id": "5AD"},
  {"label": "AOD-9604 (10mg)", "id": "10AD"},
  {"label": "FOXO4-DRI (10mg)", "id": "F410"},
  {"label": "AHK-CU (100mg)", "id": "AU100"},
  {"label": "Glutathione (1500mg)", "id": "GTT"},
  {"label": "HGH 191AA (Somatropin) (10iu)", "id": "H10"},
  {"label": "HGH 191AA (Somatropin)(12iu)", "id": "H12"},
  {"label": "HGH 191AA (Somatropin) (15iu)", "id": "H15"},
  {"label": "HGH 191AA (Somatropin) (24iu)", "id": "H24"},
  {"label": "HGH 191AA (Somatropin) (36iu)", "id": "H36"},
  {"label": "KissPeptin-10 (10mg)", "id": "KS10"},
  {"label": "VIP (5mg)", "id": "VP5"},
  {"label": "VIP (10mg)", "id": "VP10"},
  {"label": "snap-8 (10mg)", "id": "NP810"},
  {"label": "HCG (5,000iu)", "id": "G5K"},
  {"label": "HCG (10,000iu)", "id": "G10K"},
  {"label": "PT-141 (10mg)", "id": "P41"},
  {"label": "Ara-290 (10mg)", "id": "RA10"},
  {"label": "Pinealon (20mg)", "id": "PIN20"},
  {"label": "SLU-PP-332 (5mg)", "id": "332"},
  {"label": "easytouch 31 gauge 1ml 5/16\" 8mm (10 pack)", "id": "ET10"},
  {"label": "Lemon Bottle (10mg/10mL)", "id": "LB10"},
  {"label": "Acetic Acid 6% (10mL)", "id": "AA10"},
  {"label": "Bac Water (10mL)", "id": "WA10"},
  {"label": "Hospira Bac Water (30mL)", "id": "HOS30"}
];

function normKey(s){ return String(s||'').toLowerCase().replace(/\s+/g,'').replace(/["']/g,''); }

const INVENTORY_ID_MAP = INVENTORY_IDS.reduce((acc, x)=>{ acc[normKey(x.label)] = x.id; return acc; }, {});

function makeInvLabel(name, strengthOrDose){
  const s = String(strengthOrDose||'').replace(/\s+/g,''); // e.g. "5mg", "10mg/10mL", "5,000iu", "10pack"
  const n = String(name||'').trim();

  // For GLP code families, label uses the short code only (not the long parenthetical)
  if (/^GLP-3RT\b/i.test(n)) return `GLP-3RT (${s})`;
  if (/^GLP-2TZ\b/i.test(n)) return `GLP-2TZ (${s})`;
  if (/^GLP-1SG\b/i.test(n)) return `GLP-1SG (${s})`;

  return `${n} (${s})`;
}

function getInventoryId(name, strengthOrDose){
  const key = normKey(makeInvLabel(name, strengthOrDose));
  return INVENTORY_ID_MAP[key] || '';
}


/* ---------- Starter dose map (neutral defaults) ---------- */
const STARTERS = Object.fromEntries(GUIDE.map(x => [x.key, {dose:0, unit:'mg'}]));
STARTERS.melanotan = {dose:0, unit:'mcg'};
STARTERS.melanotan2 = {dose:0, unit:'mcg'};
STARTERS.hgh191aasomatropin = {dose:0, unit:'iu'};
STARTERS.hcg = {dose:0, unit:'iu'};



/* ---------- COA (Certificate of Analysis) ----------
   One COA per peptide (NOT per size). Add images later like:
   COA_MAP["glp3rt"] = "coa_retatrutide.png";
   COA_MAP["hgh191aa"] = "coa_somatropin.png";
   Images should sit next to this HTML file (or use full URLs).
*/
const COA_MAP = {
  // Retatrutide
  "glp3rt": "coa_retatrutide.jpg",

  // GHK-CU
  "ghkcu": "coa_ghk_cu.jpg",

  // Tesamorelin
  "tesamorelin": "coa_tesamorelin.jpg",

  // HGH 191AA (Somatropin)
  "hgh191aa": "coa_hgh_191aa.jpg",
};

function coaPanelHTML(item){
  if(item.category === 'supplies') return '';
  const src = COA_MAP[item.key];
  const name = esc(item.name);
  const note = '';
  if(src){
    return `
      <div class="coa-head"><b>COA</b><span class="coa-note">${note}</span></div>
      <div class="coa-body">
        <img class="coa-img" src="${esc(src)}" alt="COA for ${name}">
      </div>
    `;
  }
  return `
    <div class="coa-head"><b>COA</b><span class="coa-note">${note}</span></div>
    <div class="coa-body">
      <div class="coa-placeholder">
        <span class="tag">COA incoming</span>
        <div class="hint">COA image for <b>${name}</b> will appear here soon.</div>
      </div>
    </div>
  `;
}

/* ---------- Shared Out-of-Stock toggle ---------- */
let hideOOS = false;

function syncOOSToggles(){
  const label = hideOOS ? 'Showing in-stock only' : 'Hide out-of-stock';
  const g = document.getElementById('toggleOOS');
  const p = document.getElementById('ptoggleOOS');
  [g,p].forEach(btn=>{
    if(!btn) return;
    btn.classList.toggle('active', hideOOS);
    btn.setAttribute('aria-pressed', hideOOS ? 'true' : 'false');
    btn.textContent = label;
  });
}

function stockBadgeHTML(stock){
  const s = Number(stock)||0;
  const cls = s<=0 ? 'out' : (s<=5 ? 'low' : 'ok');
  const label = s<=0 ? 'Out' : `${s} in stock`;
  return `<span class="stock-badge ${cls}">${label}</span>`;
}

/* ---------- GUIDE + MINI CLASSIC ---------- */
const grid  = document.getElementById('grid');
const empty = document.getElementById('empty');
const q     = document.getElementById('q');

function classicMiniHTML(id, amountPerVial, vialUnit, starter, syringeScale=100, stock=0, label="") {
  const diluentDefault = 1.0;

  const res = classicCalc({
    amountPerVial, vialUnit,
    diluentMl:diluentDefault,
    desired: starter.dose, desiredUnit: starter.unit,
    syringeScale
  });

  const unitLabel = (String(vialUnit||'mg').toLowerCase()==='iu') ? 'IU' : 'mg';
  const altLabel  = (unitLabel==='mg') ? 'mcg' : null;

  return `
    <div class="mini-head">
      <div>
        Peptide calculator
        <div class="mini-sub">${esc(label)} • ${stockBadgeHTML(stock)}</div>
      </div>
      <button class="close-mini" data-close="${id}">Close</button>
    </div>
    <div class="mini-body" data-mini="${id}">
      <div class="mini-grid">
        <div class="mini-field">
          <label>Peptide per vial</label>
          <div class="dose-row">
            <input class="desired-input" type="number" step="0.01" value="${isFinite(amountPerVial)?amountPerVial:0}" data-role="amountPerVial">
            <select data-role="vialUnit">
              <option value="mg"${unitLabel==='mg'?' selected':''}>mg</option>
              <option value="iu"${unitLabel==='IU'?' selected':''}>IU</option>
            </select>
          </div>
        </div>

        <div class="mini-field" data-role-wrap="diluent">
          <label>Diluent added (mL)</label>
          <input type="number" step="0.01" value="${diluentDefault}" data-role="diluentMl">
        </div>

        <div class="mini-field">
          <label>Desired dose</label>
          <div class="dose-row">
            <input class="desired-input" type="number" step="0.001" value="${starter.dose}" data-role="desired">
            <select data-role="unit">
              <option value="mg"${starter.unit==='mg'?' selected':''}>mg</option>
              <option value="mcg"${starter.unit==='mcg'?' selected':''}>mcg</option>
              <option value="iu"${starter.unit==='iu'?' selected':''}>IU</option>
            </select>
          </div>
        </div>

        <div class="mini-field" data-role-wrap="syringe">
          <label>Syringe scale</label>
          <select data-role="syringe">
            <option value="30">U-30</option>
            <option value="50">U-50</option>
            <option value="100" selected>U-100</option>
          </select>
        </div>
      </div>

      <div class="classic" data-classic>
        <div class="tube">
          <div class="fill" data-fill style="width:${res.unitsPct}%"></div>
          <div class="cursor" data-cursor style="left:calc(${res.unitsPct}% - 1px)"></div>
        </div>
        <div class="ticks" data-ticks></div>

        <div class="mini-stats">
          <div class="stat"><b>Units to pull</b><span data-out="units">${(isFinite(res.units)?res.units:0).toFixed(2)}</span></div>
          <div class="stat">
            <b>Potency</b>
            <span>
              <span data-out="perUnitVal">${(isFinite(res.vialUnitsPerUnit)?res.vialUnitsPerUnit:0).toFixed(4)}</span>
              <span data-out="perUnitUnit">${unitLabel}</span> per unit
              ${altLabel ? `(<span data-out="altPerUnitVal">${(isFinite(res.vialUnitsPerUnit)?(res.vialUnitsPerUnit*1000):0).toFixed(2)}</span> ${altLabel}/unit)` : ``}
            </span>
          </div>
        </div>

        <div class="warn" data-warn style="display:none"></div>
        <div class="small" style="opacity:.85;margin-top:6px">Assumes insulin syringe; scale (30/50/100 units) chosen above. 1 unit = 0.01 mL.</div>
      </div>
    </div>
  `;
}

function doseChipHTML(cardId, doseStr, stock){
  const s = Number(stock)||0;
  if (hideOOS && s <= 0) return '';

  const id = `${cardId}-${doseStr.replace(/\s+/g,'')}`;
  const disabled = s <= 0;

  return `
    <button class="dose" ${disabled?'disabled':''} data-stock="${s}" data-dose="${doseStr}" data-for="${cardId}" aria-controls="mini-${id}" aria-expanded="false">
      <span>${doseStr}</span>
      ${stockBadgeHTML(s)}
    </button>
    <div id="mini-${id}" class="mini-wrap"></div>
  `;
}

function cardHTML(item, idx){
  const cardId = `card${idx}-${item.key}`;
  const showOnset = item.category!=='supplies' && item.onset && item.onset.trim()!=='—';

  if (hideOOS) {
    const anyInStock = (item.doses || []).some(d => ((item.stock && item.stock[d]) || 0) > 0);
    if (!anyInStock) return '';
  }

  const chips = (item.doses||[])
    .map(d => doseChipHTML(cardId, d, (item.stock && item.stock[d]) || 0))
    .join('');

  return `
    <article class="card" id="${cardId}" data-cat="${item.category}" data-key="${item.key}">
      <div class="title"><h3>${esc(item.name)}</h3><span class="pill">${esc(item.badge)}</span></div>
      <p class="desc">${esc(item.short)}</p>
      ${showOnset?`<div class="onset"><strong>When you notice changes:</strong> ${esc(item.onset)}</div>`:''}
      ${item.fact?`<div class="small" style="opacity:.9">Fact: ${esc(item.fact)}</div>`:''}
      ${(()=>{
        const pills=(item.doses||[]).map(d=>{
          const id=getInventoryId(item.name,d);
          if(!id) return '';
          return `<span class=\"inv-pill\"><strong>${esc(d)}</strong> ${esc(id)}</span>`;
        }).filter(Boolean).join('');
        return pills ? '<div class="inv-area"><div class="inv-title">Inventory IDs</div><div class="inv-pills">' + pills + '</div></div>' : '';
      })()}
      <div class="dose-label">Available sizes:</div>
      <div class="doses">${chips}</div>
      <details class="dropdown"><summary>More info <span class="small" style="opacity:.7">▼</span></summary><div class="drop-body">${item.more}</div></details>
      ${item.category!=='supplies' ? `
        <div class="coa-row">
          <button class="chip coa-btn" data-coa-btn="1" data-key="${item.key}" type="button">COA</button>
        </div>
        <div class="coa-panel" id="coa-${item.key}"></div>
      ` : ``}
    </article>
  `;
}

function buildTicks(elTicks, scaleMax){
  elTicks.innerHTML='';
  const minorStep = (scaleMax<=30?1:(scaleMax===50?1:2));
  const majorStep = (scaleMax<=30?5:(scaleMax===50?5:10));
  for(let i=0;i<=scaleMax;i+=minorStep){
    const div=document.createElement('div');
    div.className = 'tick ' + (i%majorStep===0?'major':'minor');
    elTicks.appendChild(div);
    if(i%majorStep===0){
      const n=document.createElement('div'); n.className='n'; n.textContent=String(i);
      div.appendChild(n);
    }
  }
}

function wireMini(container){
  const scope   = container.querySelector('[data-mini]');
  const classic = container.querySelector('[data-classic]');
  const elTicks = classic.querySelector('[data-ticks]');
  const fillEl  = classic.querySelector('[data-fill]');
  const curEl   = classic.querySelector('[data-cursor]');
  const warnEl  = classic.querySelector('[data-warn]');
  const syringeSel = scope.querySelector('[data-role="syringe"]');

  const read = () => ({
    amountPerVial: Number(scope.querySelector('[data-role="amountPerVial"]').value),
    vialUnit:  scope.querySelector('[data-role="vialUnit"]').value,
    diluentMl: Number(scope.querySelector('[data-role="diluentMl"]').value),
    desired:   Number(scope.querySelector('[data-role="desired"]').value),
    desiredUnit: scope.querySelector('[data-role="unit"]').value,
    scale:     Number(syringeSel.value)
  });

  const write = (res) => {
    const uOut = classic.querySelector('[data-out="units"]');
    const perUVal  = classic.querySelector('[data-out="perUnitVal"]');
    const perUUnit = classic.querySelector('[data-out="perUnitUnit"]');
    const altVal   = classic.querySelector('[data-out="altPerUnitVal"]');

    uOut.textContent = isFinite(res.units)?res.units.toFixed(2):'—';
    perUVal.textContent = isFinite(res.vialUnitsPerUnit)?res.vialUnitsPerUnit.toFixed(4):'—';
    perUUnit.textContent = (res.vialUnit==='iu') ? 'IU' : 'mg';

    if (altVal) {
      altVal.textContent = (res.vialUnit==='mg' && isFinite(res.vialUnitsPerUnit))
        ? (res.vialUnitsPerUnit*1000).toFixed(2)
        : '—';
    }

    const pct = (isFinite(res.units)&&res.syringeScale>0) ? Math.max(0,Math.min(100,(res.units/res.syringeScale)*100)) : 0;
    fillEl.style.width = pct + '%';
    curEl.style.left   = `calc(${pct}% - 1px)`;

    // Warnings: unit mismatch and/or syringe overflow
    const warns = [];
    if (res.note) warns.push(`⚠️ ${res.note}`);
    if (isFinite(res.units) && res.units > res.syringeScale) {
      warns.push(`⚠️ Dose exceeds the selected syringe scale of ${res.syringeScale} units. Consider more diluent, a larger syringe, or a smaller dose.`);
    }

    if (warns.length) {
      warnEl.textContent = warns.join(' ');
      warnEl.style.display = 'block';
    } else {
      warnEl.textContent = '';
      warnEl.style.display = 'none';
    }
  };

  function recalcAndRender(){
    const v = read();
    buildTicks(elTicks, v.scale||100);
    const res = classicCalc({
      amountPerVial: v.amountPerVial,
      vialUnit: v.vialUnit,
      diluentMl: v.diluentMl,
      desired: v.desired,
      desiredUnit: v.desiredUnit,
      syringeScale: v.scale||100
    });
    write(res);
  }

  ['input','change','keyup'].forEach(evt=>{
    scope.querySelectorAll('input,select').forEach(el=>el.addEventListener(evt,recalcAndRender));
  });

  recalcAndRender();
}

function renderGuide(list){
  const html = list.map((x,i)=>cardHTML(x,i)).join('');
  grid.innerHTML = html;
  empty.style.display = html.trim() ? 'none' : 'block';

  grid.querySelectorAll('.dose').forEach(btn=>{
    btn.addEventListener('click',()=>{
      if (btn.disabled) return;

      const doseStr = btn.dataset.dose;
      const stock   = Number(btn.dataset.stock)||0;


      // Kits are bundles/sets (not a single vial concentration). Don't open the syringe calculator.
      if (/\bkit\b/i.test(doseStr)) { return; }
      const card    = btn.closest('.card');
      const key     = card.dataset.key;
      const starterRaw = STARTERS[key] || {dose:0, unit:'mg'};

      const mgMatch = doseStr.match(/([\d.]+)\s*mg/i);
      const iuMatch = doseStr.match(/([\d.]+)\s*iu/i);

      let amountPerVial = 0;
      let vialUnit = 'mg';
      if (mgMatch) { amountPerVial = parseFloat(mgMatch[1]); vialUnit = 'mg'; }
      else if (iuMatch) { amountPerVial = parseFloat(iuMatch[1]); vialUnit = 'iu'; }

      // If the selected vial is in IU, default desired-dose unit to IU as well
      const starter = (vialUnit==='iu') ? {...starterRaw, unit:'iu'} : starterRaw;

      const cardId = btn.dataset.for;
      const miniId = `mini-${cardId}-${doseStr.replace(/\s+/g,'')}`;
      const mini   = document.getElementById(miniId);
      const open   = mini.style.display==='block';

      document.querySelectorAll('.mini-wrap').forEach(m=>m.style.display='none');
      document.querySelectorAll('.dose').forEach(d=>d.setAttribute('aria-expanded','false'));

      if(!open){
        mini.innerHTML = classicMiniHTML(miniId, amountPerVial, vialUnit, starter, 100, stock, doseStr);
        mini.style.display = 'block';
        btn.setAttribute('aria-expanded','true');
        wireMini(mini);
        mini.querySelector('.close-mini').addEventListener('click', ()=>{
          mini.style.display='none';
          btn.setAttribute('aria-expanded','false');
        });

  // COA buttons (one per peptide)
  grid.querySelectorAll('[data-coa-btn]').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const key = btn.dataset.key;
      const card = btn.closest('.card');
      const item = (GUIDE||[]).find(x=>x.key===key);
      const panel = card.querySelector('#coa-'+key);
      if(!panel || !item) return;
      const open = panel.classList.contains('open');
      // close any other open COA panels
      document.querySelectorAll('.coa-panel.open').forEach(p=>p.classList.remove('open'));
      if(open){
        panel.classList.remove('open');
        return;
      }
      panel.innerHTML = coaPanelHTML(item);
      panel.classList.add('open');
    });
  });

      }
    });
  });
}

/* Filters & render */
let activeFilter='all';
function applyFilters(){
  const term=(q.value||'').toLowerCase();
  const filtered = GUIDE.filter(x=>{
    const pass = activeFilter==='all'||x.category===activeFilter;
    const blob = (x.name+' '+x.short+' '+x.badge+' '+x.category+' '+(x.fact||'')).toLowerCase();
    return pass && (term===''||blob.includes(term));
  });
  renderGuide(filtered);
}

/* ---------- PRICE TABLE ---------- */
const priceTbody=document.querySelector('#priceTable tbody');
const pempty=document.getElementById('pempty');
const pq=document.getElementById('pq');

function parseAmt(s){
  const str = String(s||'');
  // Kits: "10mg kit x10" => total mg = 10 * 10 = 100
  const kit = str.match(/([\d.]+)\s*mg\b.*\bkit\b.*\bx(\d+)\b/i);
  if(kit){
    const mg = parseFloat(kit[1]);
    const x  = parseFloat(kit[2]);
    if(!isNaN(mg) && !isNaN(x)) return mg * x;
  }
  // Default: parse leading numeric (e.g., "10 mg", "36 iu", "30 mL")
  const n = parseFloat(str);
  return isNaN(n) ? 0 : n;
}
const rows=PRICES.map(([name,strength,price,unit,stock])=>{
  const amount=parseAmt(strength);
  const invId = getInventoryId(name, strength);
  return {invId,name,strength,amount,price,ppu: amount?price/amount:0,unit,stock:Number(stock)||0};
});

let priceSortKey = null;
let priceSortDir = 1;

function renderPrices(list){
  priceTbody.innerHTML=list.map(r=>`
    <tr>
      <td class="inv">${esc(r.invId||"—")}</td>
      <td>${esc(r.name)}</td>
      <td>${esc(r.strength)}</td>
      <td class="num">${r.amount?num(r.amount):'—'}</td>
      <td class="num">${money(r.price)}</td>
      <td class="num">${r.amount?money(r.ppu):'—'}</td>
      <td class="num">${r.stock}</td>
      <td><span class="unit-pill">${esc(r.unit)}</span></td>
    </tr>`).join('');
  pempty.style.display=list.length?'none':'block';
}

function getFilteredPriceRows(){
  const t = (pq.value || '').toLowerCase();
  let list = rows.filter(r => (r.invId+' '+r.name+' '+r.strength).toLowerCase().includes(t));
  if (hideOOS) list = list.filter(r => (Number(r.stock)||0) > 0);

  if (priceSortKey) {
    list = [...list].sort((a,b)=>(
      (typeof a[priceSortKey] === 'number'
        ? (a[priceSortKey] - b[priceSortKey])
        : String(a[priceSortKey]).localeCompare(String(b[priceSortKey])))
    ) * priceSortDir);
  }

  return list;
}

function applyPriceFilters(){
  renderPrices(getFilteredPriceRows());
}

pq.addEventListener('input', applyPriceFilters);

document.querySelectorAll('th.sort').forEach(th=>{
  th.addEventListener('click',()=>{
    const key = th.dataset.sort;
    if (priceSortKey === key) priceSortDir *= -1;
    else { priceSortKey = key; priceSortDir = 1; }
    applyPriceFilters();
  });
});

/* ---------- Expand/Collapse ---------- */
document.getElementById('expand').addEventListener('click',()=>document.querySelectorAll('details').forEach(d=>d.open=true));
document.getElementById('collapse').addEventListener('click',()=>document.querySelectorAll('details').forEach(d=>d.open=false));

/* ---------- Category chips ---------- */
document.querySelectorAll('.chip[data-filter]').forEach(c=>c.addEventListener('click',()=>{
  document.querySelectorAll('.chip[data-filter]').forEach(x=>x.classList.remove('active'));
  c.classList.add('active'); activeFilter=c.dataset.filter; applyFilters();
}));
q.addEventListener('input',applyFilters);

/* ---------- Hide OOS toggle ---------- */
function toggleOOS(){
  hideOOS = !hideOOS;
  syncOOSToggles();
  applyFilters();
  applyPriceFilters();
}
document.getElementById('toggleOOS')?.addEventListener('click', toggleOOS);
document.getElementById('ptoggleOOS')?.addEventListener('click', toggleOOS);

/* ---------- Tabs ---------- */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    t.classList.add('active');
    document.getElementById(t.dataset.tab).classList.add('active');
  });
});

/* ---------- Initial render ---------- */
syncOOSToggles();
applyFilters();
applyPriceFilters();

/* ---------- COA Modal (lightbox) ---------- */
let BVS__coaList = [];
let BVS__coaIndex = 0;
let BVS__coaName = "";

function BVS_openCoaModal(list, productName){
  const overlay = document.getElementById('bvsCoaModal');
  const img     = document.getElementById('bvsCoaImg');
  const sub     = document.getElementById('bvsCoaModalSub');
  const prevBtn = document.getElementById('bvsCoaPrev');
  const nextBtn = document.getElementById('bvsCoaNext');
  const countEl = document.getElementById('bvsCoaCount');

  BVS__coaList = Array.isArray(list) ? list : (list ? [list] : []);
  BVS__coaIndex = 0;
  BVS__coaName = productName || "";

  // Ensure modal events are wired (close button / ESC / outside click)
  BVS_wireCoaModal();

  if(!overlay || !img || !sub) return;

  sub.textContent = BVS__coaName;

  const render = ()=>{
    const src = BVS__coaList[BVS__coaIndex];
    img.src = src;
    img.alt = BVS__coaName ? `COA for ${BVS__coaName}` : 'COA';
    const many = BVS__coaList.length > 1;
    if(prevBtn) prevBtn.style.display = many ? 'inline-flex' : 'none';
    if(nextBtn) nextBtn.style.display = many ? 'inline-flex' : 'none';
    if(countEl) countEl.style.display = many ? 'inline' : 'none';
    if(many && countEl) countEl.textContent = `${BVS__coaIndex+1} / ${BVS__coaList.length}`;
  };

  if(prevBtn) prevBtn.onclick = ()=>{ if(BVS__coaList.length){ BVS__coaIndex = (BVS__coaIndex-1+BVS__coaList.length)%BVS__coaList.length; render(); } };
  if(nextBtn) nextBtn.onclick = ()=>{ if(BVS__coaList.length){ BVS__coaIndex = (BVS__coaIndex+1)%BVS__coaList.length; render(); } };

  overlay.classList.add('open');
  overlay.setAttribute('aria-hidden','false');
  document.body.style.overflow='hidden';
  render();
}

function BVS_closeCoaModal(){
  const overlay = document.getElementById('bvsCoaModal');
  if(!overlay) return;
  overlay.classList.remove('open');
  overlay.setAttribute('aria-hidden','true');
  document.body.style.overflow='';
}


function BVS_wireCoaModal(){
  const overlay = document.getElementById('bvsCoaModal');
  const closeBtn = document.getElementById('bvsCoaClose');
  if(!overlay || !closeBtn) return false;

  // Prevent double-wiring
  if(overlay.dataset.wired === '1') return true;
  overlay.dataset.wired = '1';

  closeBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    BVS_closeCoaModal();
  });

  overlay.addEventListener('click', (e)=>{
    // click outside the card closes
    if(e.target===overlay) BVS_closeCoaModal();
  });

  document.addEventListener('keydown', (e)=>{
    if(e.key==='Escape' && overlay.classList.contains('open')) BVS_closeCoaModal();
  });

  return true;
}

// Wire after DOM is ready (modal HTML sits after the main script in this file)
document.addEventListener('DOMContentLoaded', ()=>{ BVS_wireCoaModal(); });


/* Capture clicks on COA buttons: if a COA image exists, open modal and prevent inline panel */
document.addEventListener('click', (e)=>{
  const btn = e.target.closest && e.target.closest('[data-coa-btn]');
  if(!btn) return;

  const key = btn.dataset.key;
  const item = (GUIDE||[]).find(x=>x.key===key);
  if(!item) return;

  const v = COA_MAP[key];
  const list = !v ? [] : (Array.isArray(v) ? v : [v]);

  if(list.length){
    e.preventDefault();
    e.stopPropagation();
    BVS_openCoaModal(list, item.name);
  }
}, true);

</script>

  <!-- COA Modal -->
  <div id="bvsCoaModal" class="bvs-modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="bvs-modal-card" role="document">
      <div class="bvs-modal-head">
        <div style="display:flex;flex-direction:column;gap:2px">
          <b>COA</b>
          <span id="bvsCoaModalSub" class="small" style="opacity:.85"></span>
        </div>
        <div class="bvs-modal-nav">
          <button id="bvsCoaPrev" type="button" style="display:none">Prev</button>
          <span id="bvsCoaCount" class="bvs-modal-count" style="display:none"></span>
          <button id="bvsCoaNext" type="button" style="display:none">Next</button>
          <button id="bvsCoaClose" class="bvs-modal-close" type="button">Close</button>
        </div>
      </div>
      <div class="bvs-modal-body">
        <img id="bvsCoaImg" class="bvs-modal-img" alt="COA image">
      </div>
    </div>
  </div>

</body>
</html>
